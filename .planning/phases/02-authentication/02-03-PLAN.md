---
phase: 02-authentication
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/bansho/cli/keys.py
  - src/bansho/cli/__init__.py
  - src/bansho/main.py
autonomous: true

must_haves:
  truths:
    - "An operator can create and revoke API keys without writing SQL"
  artifacts:
    - path: "src/bansho/cli/keys.py"
      provides: "CLI for api-key create/revoke/list"
  key_links:
    - from: "src/bansho/cli/keys.py"
      to: "src/bansho/auth/api_keys.py"
      via: "calls repository functions"
      pattern: "from bansho\\.auth\\.api_keys import"
---

<objective>
Add a minimal CLI to manage API keys for demo and local operation.

Purpose: Make AUTH-02 practical for operators and the hackathon demo.
Output: `bansho keys ...` subcommands.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-authentication/02-02-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement keys CLI (create/list/revoke)</name>
  <files>src/bansho/cli/keys.py
src/bansho/cli/__init__.py</files>
  <action>
Add a simple CLI:
- Use `argparse` (keep dependencies minimal).
- Commands:
  - `keys create --role {admin|user|readonly}` prints API key once + key id.
  - `keys list` prints key ids/roles/revoked status (never prints secrets).
  - `keys revoke <api_key_id>`.
- Ensure the default role is `readonly`.
  </action>
  <verify>uv run python -m bansho keys --help</verify>
  <done>CLI commands exist and never print hashed or plaintext keys except at creation time.</done>
</task>

<task type="auto">
  <name>Task 2: Wire CLI into main entrypoint</name>
  <files>src/bansho/main.py</files>
  <action>
Update entrypoint to support both modes:
- `bansho serve` starts the proxy.
- `bansho keys ...` runs key management.
- Ensure running with no args prints help.
  </action>
  <verify>uv run python -m bansho --help</verify>
  <done>Entrypoint supports `serve` and `keys` subcommands.</done>
</task>

</tasks>

<verification>
- `uv run python -m bansho keys create --role readonly` creates a key and prints it once
- `uv run python -m bansho keys list` shows the created key id
</verification>

<success_criteria>
- API key management is CLI-driven and safe for demos.
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-03-SUMMARY.md`
</output>
